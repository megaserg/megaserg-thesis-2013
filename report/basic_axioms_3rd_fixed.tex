\section{Основные определения и аксиоматика}

Мы рассматриваем процесс компиляции как функцию, получающую на вход набор файлов, содержащие исходный код, и некоторый контекст. Контекст представляется в виде множества порождений. Возвращаемое значение функции, то есть результат компиляции~--- это тоже некоторое множество порождений. Здесь мы понимаем порождение не как класс-файл, а как некоторый неделимый атрибут, например, имя класса, поле класса, метод, элементарный тип и т.д. Это связано с тем, что в языках, подобных Java, наблюдаются зависимости разного рода; например, использование поля~--- совсем не то же самое, что вызов статического метода. При этом различные зависимости по-разному влияют на процесс инкрементальной компиляции при изменениях исходных файлов. К примеру, если разработчик изменил сигнатуру метода, то следует рассмотреть для перекомпиляции все файлы, где вызывался этот метод; однако если было изменено только тело метода, то такая модификация никак не могла затронуть другие файлы. Такой неоднородный граф зависимостей нельзя получить, сравнивая лишь содержимое файлов.

В полученных на вход исходных файлах могут содержаться упоминания-ссылки на такие атрибуты, определённые в других файлах, таким образом, для успешной компиляции соответствующие атрибуты должны быть представлены в контексте; в противном случае функция будет не определена (такую ситуацию назовём ``недоопределённостью''). Также возможен случай, когда в исходном файле определяется тот же самый атрибут, который уже представлен в контексте; в таком случае возникает неоднозначность, и функция будет не определена (такую ситуацию назовём ``переопределённостью''). Наконец, существуют вырожденные входы, функция на которых не определена ни в каком контексте.

Обозначим $\Sigma$~--- множество входов (исходных файлов), $\Omega$~--- множество выходов (порождений); эти множества не более чем счётны. Тогда частичная функция порождения выходов по входам (функция компиляции) будет выглядеть так:
$$gen : 2^\Omega \times 2^\Sigma \to 2^\Omega$$
Если $gen(\omega, \sigma) = \omega^\prime$, то будем говорить, что $\omega^\prime$~--- результат порождения входа $\sigma$ в контексте $\omega$.

Введём разбиение результата $gen(\omega, \sigma) = \omega^\prime$ на классы следующим образом. Класс $B^0_{\omega^\prime}$~--- это те порождения или части порождений, которые зависят только от входа $\sigma$. Класс $B^1_{\omega^\prime}$ - те порождения или части порождений, которые зависят только от входа и порождений класса $B^0_{\omega}$ из контекста. По индукции, класс $B^i_{\omega^\prime}$ - те порождения или части порождений, которые зависят только от входа и порождений классов $B^j_{\omega}$, где $j < i$.\\

Для функции порождения был установлен следующий набор аксиом:

\begin{enumerate}
	\item Аксиома о переопределённости: если $gen(\omega,\sigma)$~--- определена, то $\omega\cap gen(\omega,\sigma) = \varnothing$;
	
	\item Аксиома о дизъюнктном разбиении: если $gen(\omega,\sigma) = \omega^\prime$, то существует единственное дизъюнктное разбиение $\omega^\prime=\bigcup^\varnothing_{s\in\sigma}\omega^\prime_s$, 
	удовлетворяющее свойству 

	$$\forall s\in\sigma : gen(\omega\cup\omega^\prime\setminus\omega^\prime_s,\{s\})=\omega^\prime_s$$

	\item Аксиома об эквивалентных контекстах: $\forall s\in\Sigma,\; \forall\omega,\:\omega^\prime\subseteq\Omega:$ если $s$ невырожденное, $gen(\omega,\{s\})$ определено и $B^0_{\omega} = B^0_{\omega^\prime}$, то и $gen(\omega^\prime,\{s\})$ определено, более того, $gen(\omega,\{s\}) = gen(\omega^\prime,\{s\})$;

	\item Аксиома о минимально необходимом контексте: если $gen(\omega,\{s\})$~--- определена, то в $\omega$ существует наименьшее по включению подмножество $d_\omega(s)$, такое, что $gen(d_\omega(s), \{s\})$~--- определена;

	\item Аксиома о неопределённости: если $gen(\omega, \sigma) = \omega^\prime$ и для какого-то $s\in\sigma$ существует $s_1\in\sigma$, такой, что $d_{\omega\cup\omega^\prime\setminus\omega^\prime_s}(s) \cap \omega^\prime_{s_1}\ne\varnothing$, то $gen(\omega, \sigma\setminus s_1)$ не определена;
	
	\item Аксиома о сужении контекста: если $gen(\omega,\{s\})$~--- определено, то для произвольного $\omega^\prime\subseteq\omega$, такого, что $d_\omega(s)\subseteq\omega^\prime$, $gen(\omega^\prime, \{s\})$ тоже определено и равно $gen(\omega,\{s\})$.
\end{enumerate}

Как видно, аксиомы довольно естественны в том смысле, что не накладывают на функцию компиляции ограничений, оторванных от реального мира.\\

Приведём очевидное, но полезное следствие из аксиомы о дизъюнктном разбиении:

\textbf{Следствие.}
Если $gen(\omega, \sigma) = \omega^\prime$, то для любого $\tau \subseteq \sigma$ можно определить $\omega^\prime_\tau = \bigcup\limits_{s\in\tau}\omega^\prime_s$, при этом $\tau_1 \cap \tau_2 = \varnothing \Leftrightarrow \omega^\prime_{\tau_1} \cap \omega^\prime_{\tau_2} = \varnothing$.\\

% --------------------------------------------------

Введём понятие дифференциала, которое поможет сформулировать теоремы об инкрементальной компиляции и о переиспользовании порождений.

\textbf{Определение.} Пусть $\omega$, $\tilde{\omega}$ --- множества выходов, $\sigma$ --- множество входов. Известно, что определено $gen(\omega, \sigma) = \omega^\prime$, $gen(\tilde{\omega}, \sigma) = \tilde{\omega}^\prime$. Тогда дифференциал $\partial\dfrac{\omega}{\tilde{\omega}}\sigma = \partial$ --- это наименьшее подмножество $\sigma$, удовлетворяющее свойству: 
$gen(\omega \cup \omega^\prime_{\partial}, \sigma\setminus\partial)$ и
$gen(\tilde{\omega} \cup \tilde{\omega}^\prime_{\partial}, \sigma\setminus\partial)$ либо одновременно не определены, либо одновременно определены и равны.\\

\textbf{Свойство 1}: $\partial$ всегда определён и в худшем случае равен $\sigma$.\\

\textbf{Свойство 2}: $\partial\dfrac{\omega}{\omega}\sigma = \varnothing$.\\

\begin{comment}
	Вопрос: верно ли, что в условиях инкрементального случая (там, где $\Delta^\rho_\alpha\sigma$)

	$$\partial\dfrac{\omega_\rho}{\omega_\alpha}(\sigma\setminus\rho)\subseteq\xi$$ ?

	\textbf{Доказательство:}

	\newcommand{\mypart}{\partial\dfrac{\omega_\rho}{\omega_\alpha}(\sigma\setminus\rho)}

	Докажем, что если $s \in \sigma\setminus\rho$, $s \notin \xi$, то $s \notin \mypart$. Обозначим $\tau = (\sigma\setminus\rho)\setminus\mypart$, тогда $\tau$ --- наибольшее подмножество $\sigma\setminus\rho$, такое, что $gen(\omega_\rho, \tau)$ определено $\Leftrightarrow$ $gen(\omega_\alpha, \tau)$ определено. Предположим, $s \in \mypart$, тогда $s \notin \tau$. Рассмотрим $gen(\omega_\rho, \tau)$.
\end{comment}

\input{preamble.tex}

\begin{document}

\input{basic_axioms_3rd_fixed.tex}

\hrulefill

\textbf{Определение.} Пусть $\omega$, $\tilde{\omega}$ --- множества выходов, $\sigma$ --- множество входов. Известно, что определено $gen(\omega, \sigma) = \omega^\prime$, $gen(\tilde{\omega}, \sigma) = \tilde{\omega}^\prime$. Тогда $\partial\dfrac{\omega}{\tilde{\omega}}\sigma = \partial$ --- это наименьшее подмножество $\sigma$, удовлетворяющее свойству: 
$gen(\omega \cup \omega^\prime_{\partial}, \sigma\setminus\partial)$ и
$gen(\tilde{\omega} \cup \tilde{\omega}^\prime_{\partial}, \sigma\setminus\partial)$ либо одновременно не определены, либо одновременно определены и равны. 
\\

2. Свойство: $\partial$ всегда определен и (на худой конец) равен $\sigma$.
\\

3. Свойство: $\partial\dfrac{\omega}{\omega}\sigma = \varnothing$.
\\

Вопрос: верно ли, что в условиях инкрементального случая (там, где $\Delta^\rho_\alpha\sigma$)

$$\partial\dfrac{\omega_\rho}{\omega_\alpha}(\sigma\setminus\rho)\subseteq\xi$$ ?

\begin{comment}
	\textbf{Доказательство:}

	\newcommand{\mypart}{\partial\dfrac{\omega_\rho}{\omega_\alpha}(\sigma\setminus\rho)}

	Докажем, что если $s \in \sigma\setminus\rho$, $s \notin \xi$, то $s \notin \mypart$. Обозначим $\tau = (\sigma\setminus\rho)\setminus\mypart$, тогда $\tau$ --- наибольшее подмножество $\sigma\setminus\rho$, такое, что $gen(\omega_\rho, \tau)$ определено $\Leftrightarrow$ $gen(\omega_\alpha, \tau)$ определено. Предположим, $s \in \mypart$, тогда $s \notin \tau$. Рассмотрим $gen(\omega_\rho, \tau)$.
\end{comment}

\newpage

% ------------------------------------------------------
\newcommand{\butpartial}{\sigma\setminus\rho\setminus\partial}

\textbf{Теорема 1 (об инкрементальной компиляции).}

Пусть дано: $\sigma \subset \Sigma$, $gen(\varnothing, \sigma) = \omega^\sigma$. Пусть $\rho, \alpha \subset \Sigma$, при этом $\rho \subseteq \sigma$, $\sigma \cap \alpha = \varnothing$; $\Delta = \Delta^\rho_\alpha\sigma = \sigma\setminus\rho\cup\alpha$. Известно, что определено $gen(\omega^\sigma_{\sigma\setminus\rho}, \alpha) = \omega_\alpha$ и $gen(\varnothing, \Delta) = \omega^\Delta$. Обозначим $\partial = \partial\dfrac{\omega^\sigma_\rho}{\omega_\alpha}(\sigma\setminus\rho)$.
Тогда:

$$gen(\varnothing, \Delta) = \omega^\sigma_{\butpartial} \cup \omega_\alpha \cup gen(\omega^\sigma_{\butpartial} \cup \omega_\alpha, \partial)$$

\textbf{Доказательство:}
Рассмотрим $\omega^\Delta_\alpha = gen(\omega^\Delta_{\sigma\setminus\rho}, \alpha)$ и $\omega_\alpha = gen(\omega^\sigma_{\sigma\setminus\rho}, \alpha)$. Поскольку $B^0_{\omega^\Delta_{\sigma\setminus\rho}} = B^0_{\omega^\sigma_{\sigma\setminus\rho}}$, то по третьей аксиоме $\omega^\Delta_\alpha = \omega_\alpha$.

Докажем, что дифференциал $\partial = \partial\dfrac{\omega^\sigma_\rho}{\omega_\alpha}(\sigma\setminus\rho)$ имеет смысл. Для этого проверим, что определены $gen(\omega^\sigma_\rho, \sigma\setminus\rho)$ и $gen(\omega_\alpha, \sigma\setminus\rho)$. Первое выражение~--- это $\omega^\sigma_{\sigma\setminus\rho}$ и определено по аксиоме о дизъюнктном разбиении. Второе выражение равно $gen(\omega^\Delta_\alpha, \sigma\setminus\rho) = \omega^\Delta_{\sigma\setminus\rho}$ (как значения $gen$ для одного и того же входа с равными контекстами) и тоже определено по аксиоме о дизъюнктном разбиении. Тогда дифференциал в нашем случае, действительно, имеет смысл.

Рассмотрим равенство $gen(\omega_\alpha, \sigma\setminus\rho) = gen(\omega^\Delta_\alpha, \sigma\setminus\rho)$ и порождения, получающиеся в левой и в правой частях из $\partial$. В левой части обозначим их $\omega^\prime_\partial = gen(\omega_\alpha \cup \omega^{\sigma\setminus\rho}_{\butpartial}, \partial)$, а в правой части это $\omega^\Delta_\partial = gen(\omega^\Delta_\alpha \cup \omega^\Delta_{\butpartial}, \partial)$. Поскольку $B^0_{\omega_\alpha \cup \omega^{\sigma\setminus\rho}_{\butpartial}} = B^0_{\omega^\Delta_\alpha \cup \omega^\Delta_{\butpartial}}$, то по третьей аксиоме $\omega^\prime_\partial = \omega^\Delta_\partial$.

Рассмотрим $\butpartial$. По свойству дифференциала известно, что имеет место равенство $gen(\omega^\sigma_\rho \cup \omega^\sigma_\partial, \butpartial) = gen(\omega_\alpha \cup \omega^\prime_\partial, \butpartial)$ (в случае, если хотя бы одна из частей равенства определена). Левая часть этого равенства равна $\omega^\sigma_{\butpartial}$ и определена по аксиоме о дизъюнктном разбиении, а правая часть вследствие равенств $\omega_\alpha = \omega^\Delta_\alpha$ и $\omega^\prime_\partial = \omega^\Delta_\partial$ равна $gen(\omega^\Delta_\alpha \cup \omega^\Delta_\partial, \butpartial)$, то есть $\omega^\Delta_{\butpartial}$. Получаем, что $\omega^\sigma_{\butpartial} = \omega^\Delta_{\butpartial}$.

Рассмотрим $gen(\omega^\sigma_{\butpartial} \cup \omega_\alpha, \partial)$ из нашего утверждения. Вследствие равенств $\omega^\sigma_{\butpartial} = \omega^\Delta_{\butpartial}$ и $\omega_\alpha = \omega^\Delta_\alpha$ оно равно $gen(\omega^\Delta_{\butpartial} \cup \omega^\Delta_\alpha, \partial)$, то есть $\omega^\Delta_\partial$.

Рассмотрим элемент $x$ из левой части утверждения: $x \in \omega^\Delta$. Так как $\Delta = \sigma\setminus\rho\cup\alpha$, то по аксиоме о дизъюнктном разбиении верно, что $x$ принадлежит одному из трёх множеств: a) $\omega^\Delta_\alpha$; b) $\omega^\Delta_{\butpartial}$; c) $\omega^\Delta_\partial$. В случае a) из равенства $\omega^\Delta_\alpha = \omega_\alpha$ следует, что $x$ принадлежит и правой части. В случае b) из равенства $\omega^\Delta_{\butpartial} = \omega^\sigma_{\butpartial}$ следует, что $x$ принадлежит и правой части. В случае c) из равенства $\omega^\Delta_\partial = gen(\omega^\sigma_{\butpartial} \cup \omega_\alpha, \partial)$ следует, что $x$ принадлежит и правой части.

Рассмотрим элемент $x$ из правой части утверждения. Верно, что $x$ принадлежит хотя бы одному из трёх множеств (на самом деле только одному): a) $\omega_\alpha$; b) $\omega^\sigma_{\butpartial}$; c) $gen(\omega^\sigma_{\butpartial} \cup \omega_\alpha, \partial)$. В случае a) из равенства $\omega_\alpha = \omega^\Delta_\alpha$ следует, что $x$ принадлежит и левой части. В случае b) из равенства $\omega^\sigma_{\butpartial} = \omega^\Delta_{\butpartial}$ следует, что $x$ принадлежит и левой части. В случае c) из равенства $gen(\omega^\sigma_{\butpartial} \cup \omega_\alpha, \partial) = \omega^\Delta_\partial$ следует, что $x$ принадлежит и левой части.

Таким образом, правая и левая части утверждения совпадают и равенство действительно имеет место.

% ------------------------------------------------------
\newpage

\textbf{Теорема 2 (о переиспользовании порождений).}

Пусть $\forall i \in [1:n]$ дано: $\sigma_i$, $\omega_i = gen(\varnothing, \sigma_i)$, $\sigma_i^\prime \subseteq \sigma_i$ ($\sigma_i^\prime \cap \sigma_j^\prime = \varnothing$ при $i \neq j$). Обозначим $\omega_i^\prime = gen_i(\sigma_i^\prime)$. Обозначим 
$$\partial_i = \partial\dfrac{\omega_i \setminus \omega_i^\prime}{\bigcup\limits_{j \neq i} \omega_j^\prime} \sigma_i^\prime$$
Тогда:
$$gen(\varnothing, \bigcup\limits_i \sigma_i^\prime) = \left( \bigcup\limits_i \omega_i^\prime \setminus \omega_{\partial_i} \right) \cup gen(\bigcup\limits_i \omega_i^\prime \setminus \omega_{\partial_i}, \bigcup\limits_i \partial_i)$$

\newcommand{\sigi}{{\sigma_i}}
\newcommand{\sigpi}{{\sigma^\prime_i}}
\newcommand{\sigpj}{{\sigma^\prime_j}}
\newcommand{\parti}{{\partial_i}}
\newcommand{\alloth}{\bigcup\limits_{j \neq i}\omega^\prime_j}
\newcommand{\rprt}{{\text{п.ч.}}}

\textbf{Доказательство:}
Обозначим $\Delta = \bigcup\limits_i \sigma_i^\prime$.

Докажем, что дифференциал $\partial_i = \partial\dfrac{\omega_i \setminus \omega_i^\prime}{\bigcup\limits_{j \neq i} \omega_j^\prime} \sigma_i^\prime$ имеет смысл. Для этого проверим, что определены $gen(\omega_{\sigi} \setminus \omega_{\sigpi}, \sigpi)$ и $gen(\alloth, \sigpi)$. Поскольку определено $gen(\varnothing, \sigi)$, то по аксиоме о дизъюнктном разбиении определено и $gen(\omega_{\sigi} \setminus \omega_{\sigpi}, \sigpi)$. TODO: почему определено $gen(\alloth, \sigpi)$?

Рассмотрим множество $\sigpi \setminus \parti$ для произвольного $i$. По определению дифференциала $gen(\omega_\sigi \setminus \omega_\sigpi \cup \omega_\parti, \sigpi\setminus\parti) = gen(\alloth \cup \omega_\parti, \sigpi\setminus\parti)$ (левая часть равенства по аксиоме по аксиоме о дизъюнктном разбиении определена и равна $\omega^\sigi_{\sigpi\setminus\parti}$, поэтому обе части равенства определены). Поскольку и $gen(\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_\parti, \sigpi \setminus \parti)$ определено по аксиоме о дизъюнктном разбиении как $\omega^\Delta_{\sigpi\setminus\parti}$, а $B^0_{\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_\parti} = B^0_{\alloth \cup \omega_\parti}$, то по третьей аксиоме $gen(\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_\parti, \sigpi \setminus \parti) = gen(\alloth \cup \omega_\parti, \sigpi\setminus\parti)$. Следовательно, $\omega^\Delta_{\sigpi\setminus\parti} = \omega^\sigi_{\sigpi\setminus\parti}$.

Рассмотрим множество $\parti$ для произвольного $i$. Поскольку определено $gen(\bigcup\limits_k \omega_k^\prime \setminus \omega_{\partial_k}, \bigcup\limits_k \partial_k)$ (TODO: почему?), то по аксиоме о дизъюнктном разбиении определено и $gen(\bigcup\limits_k \omega_k^\prime \setminus \omega_{\partial_k} \cup \bigcup\limits_{j \neq i} \omega^\rprt_{\partial_j}, \parti)$ как $\omega^\rprt_{\parti}$. Поскольку $gen(\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_{\sigpi \setminus \parti}, \parti)$ определено по аксиоме о дизъюнктном разбиении как $\omega^\Delta_{\parti}$, а $B^0_{\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_{\sigpi \setminus \parti}} = B^0_{\bigcup\limits_k \omega_k^\prime \setminus \omega_{\partial_k} \cup \bigcup\limits_{j \neq i} \omega^\rprt_{\partial_j}}$, то по третьей аксиоме $gen(\bigcup\limits_{j \neq i}\omega^\Delta_\sigpj \cup \omega^\Delta_{\sigpi \setminus \parti}, \parti) = gen(\bigcup\limits_k \omega_k^\prime \setminus \omega_{\partial_k} \cup \bigcup\limits_{j \neq i} \omega^\rprt_{\partial_j}, \parti)$. Следовательно, $\omega^\Delta_\parti = \omega^\rprt_\parti$.

Рассмотрим элемент $x$ из левой части утверждения. Так как $\Delta = \bigcup\limits_i \sigma_i^\prime$, то по аксиоме о дизъюнктном разбиении верно, что $x$ принадлежит либо $\omega^\Delta_\parti$, либо $\omega^\Delta_{\sigpi\setminus\parti}$ для некоторого $i$. В первом случае из равенства $\omega^\Delta_\parti = \omega^\rprt_\parti$ следует, что $x$ принадлежит и правой части. Во втором случае из равенства $\omega^\Delta_{\sigpi\setminus\parti} = \omega^\sigi_{\sigpi\setminus\parti}$ следует, что $x$ принадлежит и правой части.

Аналогично можно рассмотреть элемент $x$ из правой части утверждения и показать, что он принадлежит и левой части.

Таким образом, правая и левая части утверждения совпадают и равенство действительно имеет место.

\end{document}
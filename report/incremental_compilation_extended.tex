\input{preamble.tex}

\begin{document}

\newcommand{\Deltasigma}{\Delta_\alpha^\rho\sigma}

Пусть дано: $\sigma$, $\forall s \in \sigma$ $d(s) \subset 2^\Omega$, $\omega = gen(\varnothing, \sigma)$. Предположим, что $\forall \sigma' \subseteq \sigma$ также известно $\omega_{\sigma'}$~--- множество порождений, которые были сгенерированы из элементов $\sigma'$ во время вычисления $gen(\varnothing, \sigma)$.\\

Пусть есть $\Deltasigma = \sigma\setminus\rho\cup\alpha$. Хотим понять, как посчитать $gen(\varnothing, \Deltasigma)$ на основе $gen(\varnothing, \sigma)$. Обозначим $A = gen(\omega_{\sigma\setminus\rho}, \alpha)$. Определим $\xi = \{s \in \sigma\setminus\rho \mid d(s) \cap \omega_\rho \neq \varnothing\}$ (зависимые от $\rho$ элементы) и обозначим $X = gen(\omega \setminus \omega_\rho \setminus \omega_\xi \cup A, \xi)$. Также возможно, что в $\alpha$ содержатся необходимые зависимости для каких-то элементов из $\sigma$: пусть $\chi = \{s \in \sigma\setminus\rho \mid \omega_{\{s\}} = \varnothing\}$. Тогда
$$gen(\varnothing, \Deltasigma) = \omega \setminus \omega_\rho \setminus \omega_\xi \cup A \cup X \cup gen(\omega\setminus\omega_\rho\setminus\omega_\xi \cup A \cup X, \chi)$$

Теперь возникает такая ситуация: что если в последнем члене --- $gen(\omega\setminus\omega_\rho\setminus\omega_\xi \cup A \cup X, \chi)$ --- есть какие-то порождения, которых не хватало при вызове генерации для $\alpha$ или $\xi$? Пусть $\chi'$ --- те входы из $\alpha$ и $\xi$, для которых из-за этого не сгенерировалось никаких порождений. Включим их в этот последний член:  $gen(\omega\setminus\omega_\rho\setminus\omega_\xi \cup A \cup X, \chi \cup \chi')$.

------

Получилось так:

    1. Есть $\sigma$, есть $gen(\sigma)=\omega$ --- полностью собранный проект.
	
    2. Надо построить $gen(\Deltasigma)$, где $\rho$ --- что отняли из входов, $\alpha$ --- что добавили.

		a. Поскольку $\rho$ отняли, надо как минимум из порождения выбросить его образ:

            $$\omega_\rho=gen(\rho)$$

          Кроме того, кое-что из $\sigma$, не входящих в $\rho$, зависело от порождений $\rho$:

            $$\sigma_\rho=\{s\in\sigma\setminus\rho \mid d(s)\cap\omega_\rho\ne\emptyset\}$$
			
          Таким образом, надо из $\omega$ как минимум выбросить $\omega_\rho$ и $gen(\sigma_\rho)$

		b. После этого надо добавить что, что порождается из того, что осталось, то есть $gen(\alpha\cup\sigma_\rho)$. Итого:

			$$gen(\Deltasigma)=(gen(\sigma)\setminus\omega_\rho\setminus gen(\sigma_\rho))\cup gen(\alpha\cup\sigma_\rho)$$

     Вроде здесь всё можно посчитать: $\omega_\rho$ известна, $d(s)$ для всех $s$ в старом контексте известна. 
	 
$$\partial\dfrac{\omega'}{\omega}$$
\end{document}